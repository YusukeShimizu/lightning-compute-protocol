# go-lcpd (Lightning Compute Protocol Daemon)

`go-lcpd` is a reference implementation of LCP, an application-layer protocol carried over Lightning for quote → pay → result.

It provides:
- `tools/lcpd-grpcd`: a gRPC daemon that speaks the LCP v0.1 wire protocol over BOLT #1 custom messages (via `lnd`)
- `tools/lcpdctl`: a generated CLI client for the daemon (dev/debug)
- `tools/lcpd-oneshot`: a minimal Requester helper (one-shot quote/pay or interactive `-chat`)

For the LCP wire protocol spec, see `../protocol/` (e.g., `../protocol/protocol.md`).

## Development

Prerequisites:
- Go 1.24.4+ (or a Go toolchain that supports module toolchain auto-download)
- Optional: Nix (flakes enabled) + direnv for a pinned toolchain (`flake.nix`)

If you use the optional Nix devShell, it includes Go / buf / golangci-lint v2 / and (when needed) bitcoind / lnd / jq.

### Setup (no Nix)

```sh
cd go-lcpd

# unit tests
go test ./...
```

Notes:
- To build the CLI tools used in docs, install them into a repo-local `./bin/`:
  - `mkdir -p bin && GOBIN="$PWD/bin" go install ./tools/lcpd-grpcd ./tools/lcpdctl ./tools/lcpd-oneshot`

### Setup (optional Nix devShell)

```sh
cd go-lcpd
nix develop

make gen
make test
make lint
```

Notes:
- `make` is Nix-first in this repo; prefer running it from inside the devShell.
- If your IDE shows `Import 'buf/validate/validate.proto' cannot be resolved`, run `make proto-deps`.

### regtest integration tests (Bitcoin Core + lnd)

`TestIntegration_Regtest_LNDPayment` is an integration test that automatically starts `bitcoind` (regtest) and two `lnd` nodes (alice/bob) during the test run, and walks through channel open → invoice → payment.

Run (requires `bitcoind`/`lnd` on `PATH`):

```sh
cd go-lcpd
LCP_ITEST_REGTEST=1 go test ./itest/e2e -run Regtest_LNDPayment -count=1 -v
```

Details: `docs/regtest.md`

(See `docs/regtest-integration.md` for more details.)

### regtest devnet (manual playground)

If you want a manual environment (instead of the integration test), use the devnet.
It starts `bitcoind` (regtest) and two `lnd` nodes (alice/bob).

```sh
cd go-lcpd
./scripts/devnet up
```

Stop:

```sh
cd go-lcpd
./scripts/devnet down
```

Details: `docs/devnet.md`

## Onboarding (lnd + go-lcpd)

To run LCP against a real `lnd`, see:

- Quickstart (mainnet): [go-lcpd/docs/quickstart-mainnet.md](go-lcpd/docs/quickstart-mainnet.md)
- Configuration: [go-lcpd/docs/configuration.md](go-lcpd/docs/configuration.md)
- Background run + logging: [go-lcpd/docs/background.md](go-lcpd/docs/background.md)
- regtest (safer): [go-lcpd/docs/regtest.md](go-lcpd/docs/regtest.md)

## CLI (development)

For the gRPC client CLI (`tools/lcpdctl`) generated by `protoc-gen-cobra`, see `docs/cli.md`.
